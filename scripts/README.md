# 告警规则管理脚本

## 概述

本目录包含用于管理告警规则的脚本工具。

## 脚本说明

### add_alarm_rules.sh

批量添加测试用告警规则的脚本。

#### 功能特性

- ✅ 自动检查服务器连接状态
- ✅ 支持多种类型的告警规则
- ✅ 彩色输出和进度提示
- ✅ 错误处理和统计报告
- ✅ 涵盖所有资源类型的告警场景

#### 包含的告警规则类型

1. **CPU相关告警**
   - 高CPU使用率告警 (>85%)
   - CPU负载告警 (5分钟平均负载>4.0)

2. **内存相关告警**
   - 高内存使用率告警 (>85%)
   - 内存使用率警告 (70%-85%)

3. **磁盘相关告警**
   - 根分区磁盘空间告警 (/>80%)
   - 数据分区磁盘空间告警 (/data>90%)
   - 通用磁盘空间预警 (>75%)

4. **网络相关告警**
   - 网络接口错误告警 (接收错误>100)
   - Bond接口错误告警 (发送错误>50)

5. **GPU相关告警**
   - GPU计算使用率告警 (>90%)
   - GPU显存使用率告警 (>85%)
   - GPU温度告警 (>80°C)

6. **复合条件告警**
   - 磁盘空间区间告警 (60%-90%)

7. **业务相关告警**
   - 系统负载综合告警 (15分钟平均负载>8.0)

#### 使用方法

1. **确保服务器运行**
   ```bash
   # 启动告警系统服务器
   cd /Users/panjinxue/编程/yw
   ./build/MyProject
   ```

2. **运行脚本**
   ```bash
   # 直接运行
   ./scripts/add_alarm_rules.sh
   
   # 或者
   cd scripts
   ./add_alarm_rules.sh
   ```

3. **自定义服务器地址**
   ```bash
   # 编辑脚本中的服务器配置
   SERVER_URL="http://your-server:8080"
   ```

#### 输出示例

```
========================================
告警规则批量添加脚本
========================================
ℹ️  检查服务器连接...
✅ 服务器连接正常
ℹ️  开始添加告警规则...

========================================
1. CPU相关告警规则
========================================
ℹ️  正在添加告警规则: 高CPU使用率告警
✅ 高CPU使用率告警 添加成功 (ID: 12345678-1234-1234-1234-123456789012)

...

========================================
添加结果统计
========================================
总共尝试添加: 15 条告警规则
成功添加: 15 条告警规则
失败数量: 0 条告警规则
✅ 所有告警规则添加成功！
```

#### 错误处理

- 服务器连接失败时会提示并退出
- 单个规则添加失败时会显示错误信息但继续执行
- 最终会显示成功/失败统计

#### 注意事项

1. **服务器要求**
   - 确保HTTP服务器在 `localhost:8080` 运行
   - 确保数据库连接正常

2. **规则冲突**
   - 如果规则名称已存在，添加会失败
   - 建议在运行前清理现有测试规则

3. **自定义修改**
   - 可以修改脚本中的阈值和条件
   - 可以添加新的告警规则类型
   - 可以调整严重等级和描述

#### 扩展脚本

可以基于此脚本创建其他管理脚本：

- 删除告警规则脚本
- 更新告警规则脚本
- 查询告警规则脚本
- 导入/导出告警规则脚本

## 开发指南

### 添加新的告警规则

1. 在脚本中添加新的规则定义
2. 使用 `send_alarm_rule` 函数发送
3. 更新总计数器

### 修改现有规则

1. 找到对应的JSON定义
2. 修改条件、阈值或描述
3. 测试验证

### 自定义配置

在脚本顶部修改配置变量：
- `SERVER_URL`: 服务器地址
- `API_ENDPOINT`: API端点
- 添加新的颜色定义或输出格式